// filepath: c:\Users\asas1\OneDrive\Desktop\phaserRpg\src\docs\技能系統說明.md
# 技能系統說明文件

## 技能的兩個重要時間階段

技能在施放過程中有兩個重要的時間階段，這兩個階段有不同的功能：

### 1. 技能後搖 (Animation Recovery / Backswing)
- 技能施放後，角色需要完成特定動作的時間
- 在後搖期間，角色通常**無法移動**或執行其他動作
- 當後搖結束，角色恢復正常行動能力
- 後搖是**角色動作限制**
- 每次施放技能都會觸發後搖
- 後搖時間由 `Skill.getRecoveryTime()` 方法提供

### 2. 技能冷卻 (Cooldown)
- 技能使用後，在一段時間內無法再次使用該技能的限制
- 在冷卻期間，角色可以**正常移動**和使用其他未在冷卻中的技能
- 冷卻僅影響**特定技能的可用性**
- 冷卻時間由 `Skill.getCooldown()` 方法提供
- 冷卻狀態由 `Skill.isOnCooldown()` 方法判定

## 事件流程

1. 當玩家按下技能按鍵:
   - 觸發 `CAST_START` 事件 (前搖開始)
   - 設置 `_isCastingSkill = true` (限制角色移動)

2. 前搖結束後:
   - 觸發 `CAST_EFFECT` 事件 (技能效果產生)
   - 啟動技能冷卻 `skill.startCooldown()`
   - 技能開始產生效果 (例如發射投射物)
   - 開始後搖計時

3. 後搖結束後:
   - 觸發 `CAST_COMPLETE` 事件
   - 設置 `_isCastingSkill = false` (角色可以自由移動)
   - **注意**: 此時技能可能仍在冷卻中，但角色已可以移動

4. 冷卻結束後:
   - 技能可以再次使用 `isOnCooldown = false`

## 重要提示

- 後搖和冷卻是兩個獨立的概念
- 後搖結束 != 冷卻結束
- 後搖影響的是角色能否行動
- 冷卻影響的是特定技能能否再次使用

## 在程式碼中的實現

- `skillBehavior.ts`: 定義技能行為，包含前搖、後搖時間管理
- `skillCaster.ts`: 管理技能施放和狀態切換
- `skill.ts`: 處理技能冷卻時間
- `SkillAnimationController.ts`: 專門處理技能後搖階段
